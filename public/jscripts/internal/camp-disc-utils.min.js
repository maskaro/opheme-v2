
var smTypeForReply;if(screen.width>=320&&screen.width<=568){$("i.fa-cloud-download").remove()}else{if(screen.width>=768&&screen.width<=1024){$("i.fa-cloud-download").remove()}else{if(screen.width>568){$("#job-table tbody").on("click","tr.job i.fa-cloud-download",function(){var a=$("#preparing-file-modal");a.dialog({modal:true});$(".ui-dialog button.ui-dialog-titlebar-close").html("X");var b=$(this).closest("tr").attr("id");$.fileDownload("/"+moduleId+"/download/"+b+"/csv",{successCallback:function(c){a.dialog("close")},failCallback:function(c,d){a.dialog("close");$("#error-modal").dialog({modal:true})}})})}else{}}}$("#job-table tbody").on("click","tr.job i.fa-pause",function(){if(window["oph_"+$(this).closest("tr").attr("id")].pause()===true){$(this).hide();$(this).siblings(".fa-play").show()}});$("#job-table tbody").on("click","tr.job i.fa-play",function(){if(window["oph_"+$(this).closest("tr").attr("id")].unPause()===true){$(this).hide();$(this).siblings(".fa-pause").show()}});$("#job-table tbody").on("click","tr.job",function(){var a=$(this).attr("id");if($("#map_"+a).is(":visible")){return}if($("#loader-element.map-loader").is("hidden")){$("#loader-element.map-loader").fadeIn("slow")}a=$("#map_cc .current_map_id").html();if(parseInt(a)>0){$("#map_"+a).fadeOut(300);$("#job-table tbody tr[id="+a+"]").removeClass("info");window["oph_"+a].stopQueue()}a=$(this).attr("id");$("#map_"+a).fadeIn(300);refresh_maps(a,10);if(parseInt(window["oph_"+a].shareStatus())===1){$("#map_cc a i.fa-share.unshare").parent().fadeIn(300)}else{$("#map_cc a i.fa-share.unshare").parent().fadeOut(300)}if($("#map_cc").is(":hidden")){$("#map_cc").fadeIn(300)}$(this).addClass("info");$("#map_cc .current_map_id").html(a);window["oph_"+a].startQueue()});$("#job-table tbody").on("click","tr.job i.fa-times",function(){var a=confirm("Are you sure you want to delete this "+moduleName+"?");if(a===true){var c=$(this).closest("tr").attr("id");var b=c.replace(/^\D+/g,"");$("<form action='/"+moduleId+"/remove' method='post'>\n			<input type='hidden' name='id' value='"+b+"' />\n		</form>").appendTo("body").submit()}});$("a[href=#newJobContainer]").on("shown.bs.tab",function(){google.maps.event.trigger(window.map,"resize");window.map.panTo(new google.maps.LatLng(window.coords.lat,window.coords.lng))});$("a[href=#currentList]").on("shown.bs.tab",function(){refresh_maps()});$("a[href=#newJobContainer]").on("click",function(){for(var a in window.authKeys){if($("form#editor select[name='authKey_"+a+"[]'] option").length>1){$("form#editor select[name='authKey_"+a+"[]'] option").removeAttr("selected")}$("form#editor input[name='authKeyUse_"+a+"']").prop("checked",false);$("form#editor input[name='authKeyUse_"+a+"']").trigger("change");if($("form#editor select[name='authKey_"+a+"[]'] option").length>1){$("form#editor select[name='authKey_"+a+"[]'] option").removeAttr("selected")}$("form#editor input[name='authKeyUse_"+a+"']").prop("checked",false);$("form#editor input[name='authKeyUse_"+a+"']").trigger("change")}$("form#editor input[name=name]").val("");$("form#editor input[name=filter]").val("");$("form#editor input[name=filter_ex]").val("");$("form#editor input[name='days[]']").each(function(b,c){$(c).prop("checked",false)});$("#day-all").prop("checked",false);$("form#editor input[name=time_start]").val("");$("form#editor input[name=time_end]").val("");$("form#editor input[name=date_start]").val("");$("form#editor input[name=date_end]").val("");$("form#editor input[name=centre_lat]").val("");$("form#editor input[name=centre_lng]").val("");if(window.moduleId==="campaign"){$("form#editor input[name=hourly_limit]").val("1");$("#slider-range-max").slider("option","value",1);$("form#editor textarea[name=text]").val("");$("#preview_text").html("(no message set yet)");$("form#editor input[name=response_text]").val("");$("#response_preview_text").html("(no response message entered yet)");$("form#preview_banner").attr("src","/images/banner_placeholder.png");$("form#editor input[name=radius]").val("0.5");$("#slider-range-radius").slider("option","value",0.5)}else{$("form#editor select[name=messageLifeSpanLimit] option:first").prop("selected","selected");$("form#editor input[name=radius]").val("5");$("#slider-range-radius").slider("option","value",5)}$("#optimal-time").html("None");$("form#editor input[name=id]").val("-1");window.coords=window.coords_default;window.centre_marker.setVisible(false);window.centre_circle.setVisible(false);wizardFirst()});$("#job-table tbody").on("click","tr.job i.fa-pencil",function(){window.json=$.parseJSON($(this).closest("tr").attr("json"));for(var b in window.authKeys){if($("form#editor select[name='authKey_"+b+"[]'] option").length>1){$("form#editor select[name='authKey_"+b+"[]'] option").removeAttr("selected")}$("form#editor input[name='authKeyUse_"+b+"']").prop("checked",false);$("form#editor input[name='authKeyUse_"+b+"']").trigger("change");if($("form#editor select[name='authKey_"+b+"[]'] option").length>1){$("form#editor select[name='authKey_"+b+"[]'] option").removeAttr("selected")}$("form#editor input[name='authKeyUse_"+b+"']").prop("checked",false);$("form#editor input[name='authKeyUse_"+b+"']").trigger("change")}for(var a in window.json.authKey){$("form#editor input[name='authKeyUse_"+window.json.authKey[a].type+"']").prop("checked",true);$("form#editor input[name='authKeyUse_"+window.json.authKey[a].type+"']").trigger("change");$("form#editor select[name='authKey_"+window.json.authKey[a].type+"[]'] option[value='"+window.json.authKey[a].id+","+window.json.authKey[a].type+"']").attr("selected","selected")}$("form#editor input[name=name]").val(window.json.name);$("form#editor input[name=filter]").val(window.json.filter);$("form#editor input[name=filter_ex]").val(window.json.filter_ex);$("form#editor input[name='days[]']").each(function(c,d){$(d).prop("checked",false)});$("form#editor input[name='days[]']").each(function(e,g){var d=window.json.weekdays.split(","),f=$(g),c;for(c in d){if(d[c]===f.val()){f.prop("checked",true);break}}if(d.length===7){$("#day-all").prop("checked",true)}else{$("#day-all").prop("checked",false)}});if(window.json.end_time!=="00:00:00"){$("form#editor input[name=time_start]").val(window.json.start_time.substring(0,window.json.start_time.length-3))}else{$("form#editor input[name=time_start]").val("")}if(window.json.end_time!=="00:00:00"){$("form#editor input[name=time_end]").val(window.json.end_time.substring(0,window.json.end_time.length-3))}else{$("form#editor input[name=time_end]").val("")}if(window.json.start_date!=="0000-00-00"){$("form#editor input[name=date_start]").val(window.json.start_date)}else{$("form#editor input[name=date_start]").val("")}if(window.json.end_date!=="0000-00-00"){$("form#editor input[name=date_end]").val(window.json.end_date)}else{$("form#editor input[name=date_end]").val("")}$("form#editor input[name=centre_lat]").val(parseFloat(window.json.centre_lat).toFixed(7));$("form#editor input[name=centre_lng]").val(parseFloat(window.json.centre_lng).toFixed(7));$("form#editor input[name=radius]").val(window.json.radius);$("#slider-range-radius").slider("option","value",window.json.radius);if(window.moduleId==="campaign"){$("form#editor input[name=hourly_limit]").val(window.json.hourly_limit);$("#slider-range-max").slider("option","value",window.json.hourly_limit);$("form#editor textarea[name=text]").val(window.json.text);$("#text").keyup();$("form#editor input[name=response_text]").val(window.json.response_text);$("#response_text").keyup();if(window.json.banner.length>0){$("#preview_banner").attr("src","data:"+window.json.banner_type+";base64,"+window.json.banner);$("#preview_banner_container").show()}else{$("#preview_banner").attr("src","/images/banner_placeholder.png");$("#preview_banner_container").hide()}}else{$("form#editor select[name=messageLifeSpanLimit] option[value='"+window.json.messageLifeSpanLimit+"']").prop("selected","selected")}$("#optimal-time").html(window.authKeys[window.json.authKey[0].type][window.json.authKey[0].id]);$("form#editor input[name=id]").val(window.json.id);window.coords={lat:parseFloat(window.json.centre_lat).toFixed(7),lng:parseFloat(window.json.centre_lng).toFixed(7)};window.centre_marker.setVisible(false);window.centre_marker.setPosition(new google.maps.LatLng(window.coords.lat,window.coords.lng));window.centre_marker.setVisible(true);DrawCircle();wizardFirst();$("a[href=#newJobContainer]").tab("show")});$(".job-map").width($("#job-preview").width());$(".job-map").height($("#job-preview").height());$(".opheme_map_").width($("#job-preview").width());$(".opheme_map_").height($("#job-preview").height());$(".gm-style").width($("#job-preview").width());$(".gm-style").height($("#job-preview").height());$(".gm-style > div:first").width($("#job-preview").width());$(".gm-style > div:first").height($("#job-preview").height());window.addEventListener("orientationchange",function(){location.reload()},false);function refresh_maps(c,a){if(c){google.maps.event.trigger(window["map_"+c],"resize");window["map_"+c].panTo(new google.maps.LatLng(window["coords_"+c].lat,window["coords_"+c].lng));if(a){setTimeout("window['map_"+c+"'].setZoom("+(a+1)+")",500);setTimeout("window['map_"+c+"'].setZoom("+a+")",750)}else{var b=window["map_"+c].getZoom();setTimeout("window['map_"+c+"'].setZoom("+(b+1)+")",500);setTimeout("window['map_"+c+"'].setZoom("+b+")",750)}}else{jQuery.each(window.maps_json,function(d,f){google.maps.event.trigger(f.handle,"resize");window["map_"+f.id].panTo(new google.maps.LatLng(window["coords_"+f.id].lat,window["coords_"+f.id].lng));if(a){setTimeout("window['map_"+f.id+"'].setZoom("+(a+1)+")",500);setTimeout("window['map_"+f.id+"'].setZoom("+a+")",750)}else{var e=window["map_"+f.id].getZoom();setTimeout("window['map_"+f.id+"'].setZoom("+(e+1)+")",500);setTimeout("window['map_"+f.id+"'].setZoom("+e+")",750)}})}}function map_cc_grow(){var a=parseInt($("#map_cc .current_map_id").html());$("#list-container").hide();$("#map-container").removeClass("col-md-8").addClass("col-md-12");$(".dummy").css("padding-top","50%");$("#map_"+a+".job-map").width($("#job-preview").width()-15);$("#map_"+a+".job-map").height($("#job-preview").height());$("#map_"+a+".job-map").addClass("extra-padding");$("#map_"+a+" .opheme_map_").width($("#job-preview").width()-15);$("#map_"+a+" .opheme_map_").height($("#job-preview").height());$("#map_"+a+" .gm-style").width($("#job-preview").width()-15);$("#map_"+a+" .gm-style").height($("#job-preview").height());$("#map_"+a+" .gm-style > div:first").width($("#job-preview").width()-15);$("#map_"+a+" .gm-style > div:first").height($("#job-preview").height());refresh_maps(a);$("#map_cc a .fa-expand").hide();$("#map_cc a .fa-compress").show()}function map_cc_shrink(){var a=parseInt($("#map_cc .current_map_id").html());$("#map-container").removeClass("col-md-12").addClass("col-md-8");$(".dummy").css("padding-top","75%");$("#list-container").show();$("#map_"+a+".job-map").removeClass("extra-padding");$("#map_"+a+".job-map").width($("#job-preview").width());$("#map_"+a+".job-map").height($("#job-preview").height());$("#map_"+a+" .opheme_map_").width($("#job-preview").width());$("#map_"+a+" .opheme_map_").height($("#job-preview").height());$("#map_"+a+" .gm-style").width($("#job-preview").width());$("#map_"+a+" .gm-style").height($("#job-preview").height());$("#map_"+a+" .gm-style > div:first").width($("#job-preview").width());$("#map_"+a+" .gm-style > div:first").height($("#job-preview").height());refresh_maps(a);$("#map_cc a .fa-expand").show();$("#map_cc a .fa-compress").hide()}function map_cc_zoomIn(){var a=parseInt($("#map_cc .current_map_id").html());window["map_"+a].setZoom(window["map_"+a].getZoom()+1)}function map_cc_zoomOut(){var a=parseInt($("#map_cc .current_map_id").html());window["map_"+a].setZoom(window["map_"+a].getZoom()-1)}function map_cc_close(){var a=parseInt($("#map_cc .current_map_id").html());$("#map_"+a).fadeOut(300);map_cc_shrink();$("#map_cc").fadeOut(300)}function shareJob(){var a=parseInt($("#map_cc .current_map_id").html());if(window["oph_"+a].share()===true){$("span#share-link").click(function(){var c=this;if(document.body.createTextRange){var b=document.body.createTextRange();b.moveToElementText(c);b.select()}else{if(window.getSelection){var d=window.getSelection();var b=document.createRange();b.selectNodeContents(c);d.removeAllRanges();d.addRange(b)}}});$("#map_cc a i.fa-share.unshare").parent().show()}}function createShareForm(){var c=parseInt($("#map_cc .current_map_id").html());$("#postToSM").modal("show");$("#postToSM form").submit(function(){shareJobToSM(c);return false});$("#postToSM select[name=authKeyId]").html(window.accountsSelectOptions);$("#postToSM select[name=authKeyId]").closest(".form-group").children("label").css("text-align","left");$("#postToSM select[name=authKeyId]").closest(".form-group").children("label").addClass("col-sm-3").removeClass("col-sm-6");$("#postToSM select[name=authKeyId]").closest(".form-group").children("label").children("span").remove();$("#postToSM select[name=authKeyId]").closest("div").show();$("#postToSM button.close").closest("div").removeClass("col-sm-6").addClass("col-sm-3");var b=0;$("#postToSM select[name=authKeyId] option").each(function(){var d=$(this);b++;if(d.html().indexOf("Instagram - ")>-1){d.remove();b--}});$("#postToSM select[name=authKeyId] option:first").attr("selected","selected");$("#postToSM select[name=authKeyId]").change();if(b===1){var a=$("#postToSM [name=authKeyType]").val();$("#postToSM select[name=authKeyId]").closest(".form-group").children("label").removeClass("col-sm-3").addClass("col-sm-6");$("#postToSM select[name=authKeyId]").closest(".form-group").children("label").append("<span style='text-transform: capitalize'>"+a+"</span>");$("#postToSM select[name=authKeyId]").closest("div").hide();$("#postToSM button.close").closest("div").addClass("col-sm-6").removeClass("col-sm-3")}smTypeForReply=$("#postToSM [name=authKeyType]").val();$("#postToSM textarea").focus();setTimeout(function(){$("#postToSM textarea").change()},500);$("#postToSM span.count-message-length").html("Unlimited")}function shareJobToSM(d){var c=$("#postToSM textarea[name=msg]").val(),b=$("#postToSM input[name=authKeyType]").val(),a=$("#postToSM select[name=authKeyId]").val();$("#postToSM textarea[name=msg]").val("");$("#postToSM input[name=authKeyType]").val("");$("#postToSM select[name=authKeyId] option:first").prop("selected","selected");if(c.length>0){if(window["oph_"+d].shareToSM(c,b,a)===true){$("#map_cc a i.fa-share.unshare").parent().show()}$("#postToSM").modal("hide")}}function unShareJob(){var a=parseInt($("#map_cc .current_map_id").html());if(window["oph_"+a].unShare()===true){$("#map_cc a i.fa-share.unshare").parent().hide()}}$("#postToSM form").validate({rules:{authKeyId:{selectcheck:true},msg:{required:true,maxlength:share_max_length}},messages:{authKeyId:"Please select a Social Media Account for this Share.",msg:{required:"This is the Message your followers will see, can't be empty.",maxlength:"Please write up to "+share_max_length+" characters."}},highlight:function(a){$(a).closest(".form-group").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(a,b){if(b.parent(".input-group").length){a.insertAfter(b.parent())}else{if((b).parent().hasClass("checkbox-wrapper")){a.insertAfter(".checkbox-container")}else{a.insertAfter(b)}}},ignore:""});$("#postToSM textarea[name=msg]").on("input change",function(){var a=$(this);if(smTypeForReply==="twitter"){if(a.val().length>share_max_length){a.val(a.val().substr(0,share_max_length))}else{}$("#postToSM span.count-message-length").html(share_max_length-a.val().length)}else{}});$("#replyToMsg form").submit(function(a){a.preventDefault();sendReply();return false});var reply_SMT,reply_SMID,reply_USN,reply_UID,reply_MID,reply_OM,reply_OMD,reply_M;function createReplyForm(d,g,c,b,a,f){smTypeForReply=d;reply_SMT=d;reply_USN=g;reply_UID=c;reply_MID=b;reply_OM=a;reply_OMD=f;$("#replyToMsg").modal("show");$("#replyToMsg .modal-title span").html(reply_USN);$("#replyToMsg select[name=authKeyId]").html(window.accountsSelectOptions);$("#replyToMsg select[name=authKeyId]").closest(".row").show();var e=0;$("#replyToMsg select[name=authKeyId] option").each(function(){var h=$(this);e++;if(h.html().indexOf(capitalize(reply_SMT)+" - ")===-1){h.remove();e--}});if(e===1){$("#replyToMsg select[name=authKeyId]").closest(".row").hide()}$("#replyToMsg select[name=authKeyId] option:first").attr("selected","selected");$("#replyToMsg select[name=authKeyId]").change();$("#replyToMsg textarea").val("@"+reply_USN+" ");$("#replyToMsg textarea").focusTextToEnd();setTimeout(function(){$("#replyToMsg textarea").change()},500);$("#replyToMsg span.count-message-length").html("Unlimited")}function sendReply(){var a=parseInt($("#map_cc .current_map_id").html());reply_M=$("#replyToMsg textarea[name=msg]").val();reply_SMID=$("#replyToMsg select[name=authKeyId]").val();$("#replyToMsg textarea[name=msg]").val("");$("#replyToMsg input[name=authKeyType]").val("");$("#replyToMsg select[name=authKeyId] option:first").prop("selected","selected");if(reply_M.length>0){if(window["oph_"+a].sendReplyToSM(reply_M,reply_SMT,reply_SMID,reply_USN,reply_UID,reply_MID,reply_OM,reply_OMD)===true){}$("#replyToMsg").modal("hide");$("#replyToMsg select[name=authKeyId]").html(accountsSelectOptions)}}$("#replyToMsg form").validate({rules:{authKeyId:{selectcheck:true},msg:{required:true,maxlength:reply_max_length}},messages:{authKeyId:"Please select a Social Media Account for this Reply.",msg:{required:"This is the Message the Recipient will see, can't be empty.",maxlength:"Please write up to "+reply_max_length+" characters."}},highlight:function(a){$(a).closest(".form-group").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(a,b){if(b.parent(".input-group").length){a.insertAfter(b.parent())}else{if((b).parent().hasClass("checkbox-wrapper")){a.insertAfter(".checkbox-container")}else{a.insertAfter(b)}}},ignore:""});$("#replyToMsg textarea[name=msg]").on("input change",function(){var a=$(this);if(smTypeForReply==="twitter"){if(a.val().length>reply_max_length){a.val(a.val().substr(0,reply_max_length))}else{}$("#replyToMsg span.count-message-length").html(reply_max_length-a.val().length)}else{}});